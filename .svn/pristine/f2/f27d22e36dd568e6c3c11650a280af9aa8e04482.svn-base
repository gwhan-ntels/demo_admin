<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ntels.ccbs.distribute.mapper.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspMapper">

	<!-- 납품내역 리스트 조회 -->
	<select id="lgstCntrOrdList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">	
		<include refid="com.ntels.ccbs.system.mapper.common.service.CommonCfgMapper.paging_head"/>
			SELECT
					A.SO_ID
					, A.ORD_NO
					, A.ORD_ORG_ID
					, H.ORG_NM 		AS ORD_ORG_NM
					, A.LGST_CENT_ID
					, ( SELECT	ORG_NM
						FROM	TDNDI_ORG_INFO
						WHERE	SO_ID 	= A.SO_ID
							AND ORG_ID 	= A.LGST_CENT_ID ) AS LGST_CENT_NM
					, A.ORD_MNG_ORG_ID
					, I.ORG_NM 		AS ORD_MNG_ORG_NM
					, A.ORD_MNG_INCHRG_ID
					, A.ORD_PRGR_STAT_CD
					, A.ITEM_ID
					, B.ITEM_NM
					, A.ITEM_TP_CD
					, (
						SELECT  NAME.CODE_NM AS COMMON_CD_NM
						FROM 	TSYCO_CODE_MAST MAST
                                , TSYCO_CODE_MAST_NAME MNAME
    							, TSYCO_CODE_DETAIL DETAIL
    							, TSYCO_CODE_DETAIL_NAME NAME
						WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                                AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                                AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
    							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
    							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
    							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
    							AND MAST.COMMON_GRP   ='DN00063'
								AND DETAIL.COMMON_CD = A.ITEM_TP_CD
		       		) AS ITEM_TP_NM			--제품유형코드명
					, A.EQT_USE_CD
					, (
						SELECT  NAME.CODE_NM AS COMMON_CD_NM
						FROM 	TSYCO_CODE_MAST MAST
                                , TSYCO_CODE_MAST_NAME MNAME
    							, TSYCO_CODE_DETAIL DETAIL
    							, TSYCO_CODE_DETAIL_NAME NAME
						WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                                AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                                AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
    							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
    							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
    							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
    							AND MAST.COMMON_GRP   ='DN00065'
								AND DETAIL.COMMON_CD = A.EQT_USE_CD
		       		) AS EQT_USE_NM			--단말기용도코드명	
		       		, A.CLOR_CD
		       		, (
						SELECT  NAME.CODE_NM AS COMMON_CD_NM
						FROM 	TSYCO_CODE_MAST MAST
                                , TSYCO_CODE_MAST_NAME MNAME
    							, TSYCO_CODE_DETAIL DETAIL
    							, TSYCO_CODE_DETAIL_NAME NAME
						WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                                AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                                AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
    							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
    							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
    							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
    							AND MAST.COMMON_GRP   ='DN00078'
								AND DETAIL.COMMON_CD = A.CLOR_CD
		       		) AS COLOR_NM			--색상명
					, A.ORD_QTY
					, A.ORD_UT_PRC
					, A.ORD_AMT
					, A.ORD_ADD_TX
					, ( SELECT	CASE WHEN SUM(INOUT_ADD_TX) IS NULL THEN 0 ELSE SUM(INOUT_ADD_TX) END AS INOUT_ADD_TX		
						FROM 	TDNDT_INOUT_DTL
     					WHERE 	SO_ID 	= A.SO_ID
       						AND ORD_NO 	= A.ORD_NO ) AS ORD_INOUT_ADD_TX   --기부가세
					, A.ORD_TOT_AMT
					, A.ORD_CONF_QTY
					, ( SELECT 	CASE WHEN SUM(INOUT_QTY) IS NULL THEN 0 ELSE SUM(INOUT_QTY) END AS INOUT_QTY
						FROM 	TDNDT_INOUT_DTL
						WHERE 	SO_ID 	= A.SO_ID
							AND ORD_NO 	= A.ORD_NO
							AND INOUT_CL_CD = '2' ) AS ORD_INOUT_QTY   --기출고수량
					, A.STAT_PROC_ID
					, A.STAT_PROC_DTTM
					, ( SELECT 	STAT_PROC_DTTM
						FROM 	TDNDT_ORD_STAT_PROC_HIST
						WHERE 	SO_ID 	= A.SO_ID
							AND ORD_NO 	= A.ORD_NO
							AND ORD_PRGR_STAT_CD = '10' ) AS ORD_DT   --주문일자
					, A.DLV_ZIP_CD
					, A.DLV_BSS_ADDR
					, A.DLV_DTL_ADDR
					, CONCAT(A.DLV_BSS_ADDR, A.DLV_DTL_ADDR) AS DLV_ADDR
					, A.ORD_NOTE
					, A.ASGN_NO
					, A.ASGN_ORG_ID
			FROM 	TDNDT_ORD A
					LEFT OUTER JOIN TDNDT_ITEM B ON A.SO_ID = B.SO_ID AND A.ITEM_ID = B.ITEM_ID					
					LEFT OUTER JOIN TDNDI_ORG_INFO H ON A.SO_ID = H.SO_ID AND A.ORD_ORG_ID = H.ORG_ID
             		LEFT OUTER JOIN TDNDI_ORG_INFO I ON A.SO_ID = I.SO_ID AND A.ORD_MNG_ORG_ID = I.ORG_ID
             		INNER JOIN TDNDT_ORD_IDL_DTL J ON A.SO_ID = J.SO_ID AND A.ORD_NO = J.ORD_NO
			WHERE 	1 = 1
             	AND A.SO_ID				= #{logisticsCenterIssueInspVO.soId}			--사업ID
             	AND A.ORD_PRGR_STAT_CD 	= '20'
             	AND J.IDL_STAT_CD 		= '40'
             	
				<if test="logisticsCenterIssueInspVO.searchStatDt != null and logisticsCenterIssueInspVO.searchStatDt != ''">
					AND A.STAT_PROC_DTTM <![CDATA[ >= ]]> #{logisticsCenterIssueInspVO.searchStatDt}
				</if>
				<if test="logisticsCenterIssueInspVO.searchEndDt != null and logisticsCenterIssueInspVO.searchEndDt != ''">
					AND A.STAT_PROC_DTTM <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchEndDt}
				</if>
				<if test="logisticsCenterIssueInspVO.ordNo != null and logisticsCenterIssueInspVO.ordNo != ''">
					AND A.ORD_NO =  #{logisticsCenterIssueInspVO.ordNo}
				</if>
				<if test="logisticsCenterIssueInspVO.ordOrgId != null and logisticsCenterIssueInspVO.ordOrgId != ''">
					AND A.ORD_ORG_ID =  #{logisticsCenterIssueInspVO.ordOrgId}
				</if>
				<if test="logisticsCenterIssueInspVO.itemId != null and logisticsCenterIssueInspVO.itemId != ''">
					AND A.ITEM_ID =  #{logisticsCenterIssueInspVO.itemId}
				</if>
				<if test="logisticsCenterIssueInspVO.itemTpCd != null and logisticsCenterIssueInspVO.itemTpCd != ''">
					AND A.ITEM_TP_CD =  #{logisticsCenterIssueInspVO.itemTpCd}
				</if>
			ORDER BY A.ORD_NO DESC

		<include refid="com.ntels.ccbs.system.mapper.common.service.CommonCfgMapper.paging_foot"/>
	</select>
	
	
	<!-- 납품내역 리스트 카운트 -->
	<select id="lgstCntrOrdCount" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="int">
		SELECT 
			COUNT(0) AS TOTAL 
		FROM 	TDNDT_ORD A
				LEFT OUTER JOIN TDNDT_ITEM B ON A.SO_ID = B.SO_ID AND A.ITEM_ID = B.ITEM_ID					
				LEFT OUTER JOIN TDNDI_ORG_INFO H ON A.SO_ID = H.SO_ID AND A.ORD_ORG_ID = H.ORG_ID
            		LEFT OUTER JOIN TDNDI_ORG_INFO I ON A.SO_ID = I.SO_ID AND A.ORD_MNG_ORG_ID = I.ORG_ID
            		INNER JOIN TDNDT_ORD_IDL_DTL J ON A.SO_ID = J.SO_ID AND A.ORD_NO = J.ORD_NO
		WHERE 	1 = 1
            	AND A.SO_ID				= #{logisticsCenterIssueInspVO.soId}			--사업ID
            	AND A.ORD_PRGR_STAT_CD 	= '20'
            	AND J.IDL_STAT_CD 		= '40'
            	
			<if test="logisticsCenterIssueInspVO.searchStatDt != null and logisticsCenterIssueInspVO.searchStatDt != ''">
				AND A.STAT_PROC_DTTM <![CDATA[ >= ]]> #{logisticsCenterIssueInspVO.searchStatDt}
			</if>
			<if test="logisticsCenterIssueInspVO.searchEndDt != null and logisticsCenterIssueInspVO.searchEndDt != ''">
				AND A.STAT_PROC_DTTM <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchEndDt}
			</if>
			<if test="logisticsCenterIssueInspVO.ordNo != null and logisticsCenterIssueInspVO.ordNo != ''">
				AND A.ORD_NO =  #{logisticsCenterIssueInspVO.ordNo}
			</if>
			<if test="logisticsCenterIssueInspVO.ordOrgId != null and logisticsCenterIssueInspVO.ordOrgId != ''">
				AND A.ORD_ORG_ID =  #{logisticsCenterIssueInspVO.ordOrgId}
			</if>
			<if test="logisticsCenterIssueInspVO.itemId != null and logisticsCenterIssueInspVO.itemId != ''">
				AND A.ITEM_ID =  #{logisticsCenterIssueInspVO.itemId}
			</if>
			<if test="logisticsCenterIssueInspVO.itemTpCd != null and logisticsCenterIssueInspVO.itemTpCd != ''">
				AND A.ITEM_TP_CD =  #{logisticsCenterIssueInspVO.itemTpCd}
			</if>
	</select>
	
	<select id="lgstCntrOutList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT
				B.SO_ID
				, A.INOUT_ID AS INOUT_ID
				, A.ITEM_ID
				, ( SELECT 	ITEM_NM
					FROM 	TDNDT_ITEM
					WHERE 	SO_ID 	= A.SO_ID
						AND ITEM_ID = A.ITEM_ID ) AS ITEM_NM
				, A.INOUT_RESN_CD AS INOUT_RESN_CD
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00069'
							AND DETAIL.COMMON_CD = A.INOUT_RESN_CD
	       		) AS INOUT_RESN_NM			--입출고사유코드명
	       		, A.INOUT_CL_CD
	       		, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00071'
							AND DETAIL.COMMON_CD = A.INOUT_CL_CD
	       		) AS INOUT_CL_NM			--입출고구분코드명
	       		, A.ITEM_TP_CD
	       		, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00063'
							AND DETAIL.COMMON_CD = A.ITEM_TP_CD
	       		) AS ITEM_TP_NM			--제품유형코드명
				, A.EQT_USE_CD
	       		, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00065'
							AND DETAIL.COMMON_CD = A.EQT_USE_CD
	       		) AS EQT_USE_NM			--단말기용도코드명
	       		, A.CLOR_CD
	       		, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00078'
							AND DETAIL.COMMON_CD = A.CLOR_CD
	       		) AS COLOR_NM			--색상명
	       		, A.INOUT_QTY
				, A.INOUT_UT_PRC
				, A.NOTE
				, A.PO_NO
				, A.ORD_NO
				, B.INOUT_DT
				, B.INOUT_PRGR_STAT_CD AS INOUT_PRGR_STAT_CD
				
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   = CASE WHEN A.INOUT_CL_CD = '1' THEN 'DN00072' ELSE 'DN00073' END 
							AND DETAIL.COMMON_CD = B.INOUT_PRGR_STAT_CD
	       		) AS INOUT_PRGR_STAT_NM			--
	       		, B.STAT_PROC_ID
				, B.STAT_PROC_DTTM
	       		, SUBSTR(B.STAT_PROC_DTTM, 1, 8) AS STAT_PROC_DT
				, B.OWN_ORG_ID
				, ( SELECT 	ORG_NM
					FROM 	TDNDI_ORG_INFO
					WHERE 	SO_ID 	= B.SO_ID
						AND ORG_ID 	= B.OWN_ORG_ID ) AS OWN_ORG_NM
				, B.INOUT_ORG_ID
				, ( SELECT 	ORG_NM
					FROM 	TDNDI_ORG_INFO
					WHERE 	SO_ID 	= B.SO_ID
						AND ORG_ID 	= B.INOUT_ORG_ID ) AS INOUT_ORG_NM
				, B.REL_INOUT_ID
				, E.MNCO_NM
				, A.ACTNC_NO
				, ( SELECT 	ORG_NM
					FROM 	TDNDI_ORG_INFO
					WHERE 	ORG_ID = ( SELECT LGST_CENT_ID
										FROM TDNDT_PO
										WHERE SO_ID = A.SO_ID
										AND PO_NO = A.PO_NO )
               	) AS LGST_CENT_NM
		FROM 	TDNDT_INOUT_DTL A
				, TDNDT_INOUT B
				, TDNDT_ITEM C
				, TDNDT_MNCO E
		WHERE 	1 = 1
            	AND A.SO_ID			= #{logisticsCenterIssueInspVO.soId}			--사업ID
            	AND A.SO_ID 		= B.SO_ID
				AND A.INOUT_ID 		= B.INOUT_ID
				AND A.SO_ID 		= C.SO_ID
				AND A.ITEM_ID 		= C.ITEM_ID
				AND C.MNCO_ID 		= E.MNCO_ID
				AND A.INOUT_CL_CD 	= '2'
				AND A.ORD_NO 		= #{logisticsCenterIssueInspVO.ordNo}			--주문번호
	       		
	</select>
	
	
	<!-- 물류센터 출고 단말기내역 리스트 조회 -->
	<select id="lgstCntrOutEqtList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT
				A.SO_ID
				, A.ITEM_ID			--제품ID
				, ( SELECT 	ITEM_NM
					FROM 	TDNDT_ITEM
					WHERE 	SO_ID = A.SO_ID
						AND ITEM_ID = A.ITEM_ID ) AS ITEM_NM   --제품명
				, A.EQT_SEQ   		--일련번호
				, A.EQT_BAR_CD AS EQT_BAR_CD		--바코드
				, A.CLOR_CD			--색상코드
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00078'
							AND DETAIL.COMMON_CD = A.CLOR_CD
	       		) AS COLOR_NM			--색상명
				, A.EQT_RSRC_CL_CD   --단말기자원구분코드
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00068'
							AND DETAIL.COMMON_CD = A.EQT_RSRC_CL_CD
	       		) AS EQT_RSRC_CL_NM 		--단말기자원구분명
				, A.EQT_STAT_CD   	--단말기상태코드
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00066'
							AND DETAIL.COMMON_CD = A.EQT_STAT_CD
	       		) AS EQT_STAT_NM 		--단말기상태명
		FROM	TDNDT_EQT A   --단말기
				LEFT OUTER JOIN ( SELECT 	AA.SO_ID
							, AA.EQT_SEQ
							, AA.ITEM_ID
					FROM 	TDNDT_INOUT_EQT AA
							, TDNDT_INOUT_DTL BB
							, TDNDT_ORD_IDL_DTL CC
					WHERE 	AA.SO_ID 	= #{logisticsCenterIssueInspVO.soId}			--사업ID
						AND AA.SO_ID 	= BB.SO_ID
						AND AA.INOUT_ID = BB.INOUT_ID
						AND AA.ITEM_ID 	= BB.ITEM_ID
						AND BB.SO_ID 	= CC.SO_ID
						AND BB.ORD_NO 	= CC.ORD_NO
						AND AA.ITEM_ID 	= #{logisticsCenterIssueInspVO.itemId}			--제품ID
						AND CC.IDL_STAT_CD = '40' ) B
				ON A.SO_ID = B.SO_ID AND A.EQT_SEQ = B.EQT_SEQ AND A.ITEM_ID = B.ITEM_ID
         WHERE 	1 = 1		
         	AND A.SO_ID 	= #{logisticsCenterIssueInspVO.soId}			--사업ID
         	AND B.EQT_SEQ IS NULL
			AND B.ITEM_ID IS NULL
			AND A.EQT_STAT_CD = '001'
			AND SUBSTR(A.LGST_PROC_STAT_CD, -1) = '1'
			AND A.ITEM_ID 	= #{logisticsCenterIssueInspVO.itemId}			--제품ID
			AND A.EQT_USE_CD = #{logisticsCenterIssueInspVO.eqtUseCd}		--'10'
			
			<if test="logisticsCenterIssueInspVO.searchStatSeq != null and logisticsCenterIssueInspVO.searchStatSeq != ''">
				AND A.EQT_SEQ <![CDATA[ >= ]]> #{logisticsCenterIssueInspVO.searchStatSeq}
			</if>
			<if test="logisticsCenterIssueInspVO.searchEndSeq != null and logisticsCenterIssueInspVO.searchEndSeq != ''">
				AND A.EQT_SEQ <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchEndSeq}
			</if>
			<if test="logisticsCenterIssueInspVO.ownLocCd != null and logisticsCenterIssueInspVO.ownLocCd != ''">
				AND A.OWN_LOC_CD =  #{logisticsCenterIssueInspVO.ownLocCd}
			</if>
			<if test="logisticsCenterIssueInspVO.searchSeq != null and logisticsCenterIssueInspVO.searchSeq != ''">
				AND ROWNUM <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchSeq}
			</if>
			
		ORDER BY A.EQT_SEQ
	</select>
	
	<!-- 물류센터 출고 USIM내역 리스트 조회 -->
	<select id="lgstCntrOutUsimList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT
				A.SO_ID
				, A.ITEM_ID			--제품ID
				, ( SELECT 	ITEM_NM
					FROM 	TDNDT_ITEM
					WHERE 	SO_ID = A.SO_ID
						AND ITEM_ID = A.ITEM_ID ) AS ITEM_NM   --제품명
				, A.USIM_SEQ AS EQT_SEQ			--일련번호
				, A.USIM_BAR_CD AS EQT_BAR_CD	--바코드
				, A.USIM_STAT_CD AS EQT_STAT_CD	--단말기상태코드
				, (
					SELECT  NAME.CODE_NM AS COMMON_CD_NM
					FROM 	TSYCO_CODE_MAST MAST
                               , TSYCO_CODE_MAST_NAME MNAME
   							, TSYCO_CODE_DETAIL DETAIL
   							, TSYCO_CODE_DETAIL_NAME NAME
					WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
   							AND MAST.COMMON_GRP   ='DN00066'
							AND DETAIL.COMMON_CD = A.USIM_STAT_CD
	       		) AS EQT_STAT_NM 		--단말기상태명
				, '40' AS IDL_STAT_CD
				, A.USIM_SEQ
				, A.IMSI_NO
		FROM 	( SELECT 
						AA.SO_ID
						, AA.ITEM_ID
						, AA.USIM_SEQ
						, AA.USIM_BAR_CD
						, AA.USIM_STAT_CD
						, AA.IMSI_NO
					FROM TDNDT_USIM AA
					WHERE AA.SO_ID 		= #{logisticsCenterIssueInspVO.soId}			--사업ID
						AND AA.USIM_STAT_CD = '101'
						AND SUBSTR(AA.LGST_PROC_STAT_CD, -1) = '1'
						AND AA.ITEM_ID 	= #{logisticsCenterIssueInspVO.itemId}			--제품ID
						<!-- AND (AA.IDL_STAT_CD <![CDATA[<>]]> '40' OR AA.IDL_STAT_CD IS NULL) -->
						AND CASE WHEN AA.IDL_STAT_CD IS NULL THEN '00' ELSE AA.IDL_STAT_CD END <![CDATA[<>]]> '40'
						
					<if test="logisticsCenterIssueInspVO.searchStatSeq != null and logisticsCenterIssueInspVO.searchStatSeq != ''">
						AND A.USIM_SEQ <![CDATA[ >= ]]> #{logisticsCenterIssueInspVO.searchStatSeq}
					</if>
					<if test="logisticsCenterIssueInspVO.searchEndSeq != null and logisticsCenterIssueInspVO.searchEndSeq != ''">
						AND A.USIM_SEQ <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchEndSeq}
					</if>
					<if test="logisticsCenterIssueInspVO.ownLocCd != null and logisticsCenterIssueInspVO.ownLocCd != ''">
						AND AA.OWN_LOC_CD =  #{logisticsCenterIssueInspVO.ownLocCd}
					</if>
					<if test="logisticsCenterIssueInspVO.searchSeq != null and logisticsCenterIssueInspVO.searchSeq != ''">
						AND ROWNUM <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchSeq}
					</if>
                  ORDER BY AA.USIM_SEQ ) A
		WHERE 	1 = 1
	
	</select>
	
	<!-- 물류센터 출고 바우쳐내역 리스트 조회 -->
	<select id="lgstCntrOutVeqtList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT
				SO_ID
				, ITEM_ID			--제품ID
				, ITEM_NM			--제품명
				, EQT_SEQ			--일련번호
				, EQT_BAR_CD		--바코드
				, EQT_STAT_CD		--바우쳐상태코드
				, EQT_STAT_NM
		FROM 	(
					SELECT	 ROWNUM, DATA.*
					FROM
							(
								SELECT 
										A.SO_ID
										, A.ITEM_ID			--제품ID
										, ( SELECT ITEM_NM
											FROM TDNDT_ITEM
											WHERE SO_ID = A.SO_ID
											AND ITEM_ID = A.ITEM_ID ) AS ITEM_NM		--제품명
										, A.VO_SEQ_NO AS EQT_SEQ   --일련번호
										, A.VO_BAR_CD AS EQT_BAR_CD   --바코드
										, A.VO_STAT_CD AS EQT_STAT_CD   --단말기상태코드
										, (
											SELECT  NAME.CODE_NM AS COMMON_CD_NM
											FROM 	TSYCO_CODE_MAST MAST
						                               , TSYCO_CODE_MAST_NAME MNAME
						   							, TSYCO_CODE_DETAIL DETAIL
						   							, TSYCO_CODE_DETAIL_NAME NAME
											WHERE 	MAST.COMMON_GRP=DETAIL.COMMON_GRP
						                               AND MAST.COMMON_GRP   =MNAME.COMMON_GRP
						                               AND MNAME.LNG_TYP     =#{logisticsCenterIssueInspVO.lngTyp} 
						   							AND DETAIL.COMMON_GRP =NAME.COMMON_GRP
						   							AND DETAIL.COMMON_CD  =NAME.COMMON_CD
						   							AND NAME.LNG_TYP      = #{logisticsCenterIssueInspVO.lngTyp}
						   							AND MAST.COMMON_GRP   ='DN00066'
													AND DETAIL.COMMON_CD = A.VO_STAT_CD
							       		) AS EQT_STAT_NM 		--단말기상태명
								FROM 	TDNDT_VEQT A   --바우쳐
										LEFT OUTER JOIN ( SELECT 	AA.SO_ID, AA.EQT_SEQ, AA.ITEM_ID, AA.EQT_BAR_CD
											FROM 	TDNDT_INOUT_EQT AA
													, TDNDT_INOUT_DTL BB
													, TDNDT_ORD_IDL_DTL CC
											WHERE AA.SO_ID 			= #{logisticsCenterIssueInspVO.soId}			--사업ID
												AND AA.SO_ID 		= BB.SO_ID
												AND AA.INOUT_ID 	= BB.INOUT_ID
												AND AA.ITEM_ID 		= BB.ITEM_ID
												AND BB.SO_ID 		= CC.SO_ID
												AND BB.ORD_NO 		= CC.ORD_NO
												AND AA.ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}			--제품ID
												AND CC.IDL_STAT_CD 	= '40' ) B
										ON A.SO_ID = B.SO_ID AND A.VO_SEQ_NO = B.EQT_SEQ AND A.ITEM_ID = B.ITEM_ID
								WHERE 	1 = 1
									AND A.SO_ID 		= #{logisticsCenterIssueInspVO.soId}			--사업ID
									AND B.EQT_SEQ IS NULL
									AND B.ITEM_ID IS NULL
									AND A.VO_STAT_CD 	= '30'
									AND SUBSTR(A.LGST_PROC_STAT_CD, -1) = '1'
									AND A.ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}			--제품ID
					                <if test="logisticsCenterIssueInspVO.ownLocCd != null and logisticsCenterIssueInspVO.ownLocCd != ''">
										AND A.OWN_LOC_CD =  #{logisticsCenterIssueInspVO.ownLocCd}
									</if>
									<if test="logisticsCenterIssueInspVO.searchStatSeq != null and logisticsCenterIssueInspVO.searchStatSeq != ''">
										AND A.VO_BAR_CD <![CDATA[ >= ]]> #{logisticsCenterIssueInspVO.searchStatSeq}
									</if>
									<if test="logisticsCenterIssueInspVO.searchEndSeq != null and logisticsCenterIssueInspVO.searchEndSeq != ''">
										AND A.VO_BAR_CD <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchEndSeq}
									</if>
                 				ORDER BY A.VO_BAR_CD
              			) DATA
          		)
          			
		WHERE 1=1
			<if test="logisticsCenterIssueInspVO.searchSeq != null and logisticsCenterIssueInspVO.searchSeq != ''">
				AND ROWNUM <![CDATA[ <= ]]> #{logisticsCenterIssueInspVO.searchSeq}
			</if>
             
	</select>
	
	
	<!-- 출고내역 등록 -->
	<insert id="insertInout" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT INTO TDNDT_INOUT
			( SO_ID					--사업ID
			, INOUT_ID				--입출고ID
			, INOUT_CL_CD			--입출고구분코드
			, INOUT_DT				--입출고일자
			, INOUT_PRGR_STAT_CD	--입출고진행상태코드
			, STAT_PROC_ID			--상태처리자ID
			, STAT_PROC_DTTM		--상태처리일시
			, OWN_ORG_ID			--보유조직ID
			, INOUT_ORG_ID			--입출고조직ID
			, REL_INOUT_ID			--관련입출고ID
			, DLV_ID				--배송ID
			, REGR_ID				--등록자
			, REG_DATE				--등록일시
			, CHGR_ID				--수정자
			, CHG_DATE				--수정일시
			)
        VALUES
			( #{logisticsCenterIssueInspVO.soId}			--사업ID
			, #{logisticsCenterIssueInspVO.inoutId}			--입출고ID
			, #{logisticsCenterIssueInspVO.inoutClCd}		--입출고구분코드
			, #{logisticsCenterIssueInspVO.inoutDt}			--입출고일자
			, #{logisticsCenterIssueInspVO.inoutPrgrStatCd}	--입출고진행상태코드
			, #{logisticsCenterIssueInspVO.statProcId}		--상태처리자ID
			, #{logisticsCenterIssueInspVO.statProcDttm}	--상태처리일시
			, #{logisticsCenterIssueInspVO.ownOrgId}		--보유조직ID
			, #{logisticsCenterIssueInspVO.inoutOrgId}		--입출고조직ID
			, #{logisticsCenterIssueInspVO.relInoutId}		--관련입출고ID
			, #{logisticsCenterIssueInspVO.dlvId}			--배송ID
			, #{logisticsCenterIssueInspVO.regrId}			--등록자
			, #{logisticsCenterIssueInspVO.regDate}			--등록일시
			, #{logisticsCenterIssueInspVO.chgrId}			--수정자
			, #{logisticsCenterIssueInspVO.chgDate}			--수정일시
			)			
	</insert>
	
	
	<!-- 출고내역 등록 -->
	<insert id="insertInoutDtl" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT INTO TDNDT_INOUT_DTL
			( SO_ID				--사업ID
			, INOUT_ID			--입출고ID
			, ITEM_ID			--제품ID
			, INOUT_RESN_CD		--입출고사유코드
			, INOUT_CL_CD		--입출고구분코드
			, ITEM_TP_CD		--제품유형코드
			, EQT_USE_CD		--단말기용도코드
			, EQT_RSRC_CL_CD	--단말자원구분코드
			, CLOR_CD			--색상코드
			, INOUT_QTY			--입출고수량
			, INOUT_UT_PRC		--입출고단가
			, INOUT_AMT			--입출고공급가액
			, INOUT_ADD_TX		--입출고부가세
			, INOUT_TOT_AMT		--입출고총금액
			, NOTE				--비고
			, PO_NO				--발주번호
			, ACTNC_NO			--납품번호
			, ORD_NO			--주문번호
			, REGR_ID			--등록자
			, REG_DATE			--등록일시
			, CHGR_ID			--수정자
			, CHG_DATE			--수정일시
			)
        VALUES
			( #{logisticsCenterIssueInspVO.soId}			--사업ID
			, #{logisticsCenterIssueInspVO.inoutId}			--입출고ID
			, #{logisticsCenterIssueInspVO.itemId}			--제품ID
			, #{logisticsCenterIssueInspVO.inoutResnCd}		--입출고사유코드
			, #{logisticsCenterIssueInspVO.inoutClCd}		--입출고구분코드
			, #{logisticsCenterIssueInspVO.itemTpCd}		--제품유형코드
			, #{logisticsCenterIssueInspVO.eqtUseCd}		--단말기용도코드
			, #{logisticsCenterIssueInspVO.eqtRsrcClCd}		--단말자원구분코드
			, #{logisticsCenterIssueInspVO.clorCd}			--색상코드
			, #{logisticsCenterIssueInspVO.inoutQty}		--입출고수량
			, #{logisticsCenterIssueInspVO.inoutUtPrc}		--입출고단가
			, #{logisticsCenterIssueInspVO.inoutAmt}		--입출고공급가액
			, #{logisticsCenterIssueInspVO.inoutAddTx}		--입출고부가세
			, #{logisticsCenterIssueInspVO.inoutTotAmt}		--입출고총금액
			, #{logisticsCenterIssueInspVO.note}			--비고
			, #{logisticsCenterIssueInspVO.poNo}			--발주번호
			, #{logisticsCenterIssueInspVO.actncNo}			--납품번호
			, #{logisticsCenterIssueInspVO.ordNo}			--주문번호
			, #{logisticsCenterIssueInspVO.regrId}			--등록자
			, #{logisticsCenterIssueInspVO.regDate}			--등록일시
			, #{logisticsCenterIssueInspVO.chgrId}			--수정자
			, #{logisticsCenterIssueInspVO.chgDate}			--수정일시
			)			
	</insert>

	<!-- 출고상태처리이력 등록 -->
	<insert id="insertInoutStatProcHist" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT INTO TDNDT_INOUT_STAT_PROC_HIST
			( SO_ID					--사업ID
			, INOUT_ID				--입출고ID
			, INOUT_PRGR_STAT_CD	--입출고진행상태코드
			, STAT_PROC_ID			--상태처리자ID
			, STAT_PROC_DTTM		--상태처리일시
			, REGR_ID				--등록자
			, REG_DATE				--등록일시
			, CHGR_ID				--수정자
			, CHG_DATE				--수정일시
			)
        VALUES
			( #{logisticsCenterIssueInspVO.soId}			--사업ID
			, #{logisticsCenterIssueInspVO.inoutId}			--입출고ID
			, #{logisticsCenterIssueInspVO.inoutPrgrStatCd}	--입출고진행상태코드
			, #{logisticsCenterIssueInspVO.statProcId}		--상태처리자ID
			, #{logisticsCenterIssueInspVO.statProcDttm}	--상태처리일시
			, #{logisticsCenterIssueInspVO.regrId}			--등록자
			, #{logisticsCenterIssueInspVO.regDate}			--등록일시
			, #{logisticsCenterIssueInspVO.chgrId}			--수정자
			, #{logisticsCenterIssueInspVO.chgDate}			--수정일시
			)			
	</insert>
	
	
	<!-- 입출고 단말기 일련번호별로 관리 등록 -->
	<insert id="insertInoutEqt" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT	ALL 		
		<foreach collection="logisticsCenterIssueInspVOs" item="logisticsCenterIssueInspVO" index="index" separator="" open="" close="">
			INTO TDNDT_INOUT_EQT
				( SO_ID			--사업ID
				, INOUT_ID		--입출고ID
				, ITEM_ID		--제품ID
				, EQT_SEQ		--단말기일련번호
				, EQT_BAR_CD	--단말기바코드
				, APPR_YN		--검수여부
				, REGR_ID		--등록자
				, REG_DATE		--등록일시
				, CHGR_ID		--수정자
				, CHG_DATE		--수정일시
				)
	        VALUES
				( #{logisticsCenterIssueInspVO.soId}		--사업ID
				, #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
				, #{logisticsCenterIssueInspVO.itemId}		--제품ID
				, #{logisticsCenterIssueInspVO.eqtSeq}		--단말기일련번호
				, #{logisticsCenterIssueInspVO.eqtBarCd}	--단말기바코드
				, #{logisticsCenterIssueInspVO.apprYn}		--검수여부
				, #{logisticsCenterIssueInspVO.regrId}		--등록자
				, #{logisticsCenterIssueInspVO.regDate}		--등록일시
				, #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, #{logisticsCenterIssueInspVO.chgDate}		--수정일시
				)
		</foreach>
		SELECT * FROM DUAL			
	</insert>
	
	<!-- USIM 내역 수정 -->
	<update id="updateUsim" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		UPDATE TDNDT_USIM
			SET	IDL_STAT_CD	= #{logisticsCenterIssueInspVO.idlStatCd}			--물류처리상태코드
				, CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
		WHERE	SO_ID				= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND ITEM_ID				= #{logisticsCenterIssueInspVO.itemId}		--제품ID
			<if test="logisticsCenterIssueInspVO.eqtSeqList != null and logisticsCenterIssueInspVO.eqtSeqList.size() != 0">
			AND USIM_SEQ IN
			<foreach collection="logisticsCenterIssueInspVO.eqtSeqList" item="item" index="index" separator="," open="(" close=")">
	            #{item.eqtSeq}
	        </foreach>
        </if>
	</update>
	
	
	<!-- 출고내역 삭제 -->
	<delete id="deleteInout" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_INOUT
		WHERE	SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
    </delete>
	
	<!-- 출고내역 삭제 -->
	<delete id="deleteInoutDtl" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_INOUT_DTL
		WHERE	SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
			AND ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}		--제품ID
    </delete>
	
	<!-- 출고상태처리이력 삭제 -->
	<delete id="deleteInoutStatProcHist" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_INOUT_STAT_PROC_HIST
		WHERE	SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
    </delete>
    
    
    <!-- USIM 내역 수정2 -->
	<update id="updateUsim2" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		UPDATE TDNDT_USIM
			SET	IDL_STAT_CD = '00'
		WHERE	CONCAT(ITEM_ID,USIM_SEQ) IN (SELECT CONCAT(ITEM_ID,EQT_SEQ)
												FROM TDNDT_INOUT_EQT
												WHERE SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
												AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
											)
	</update>
    
    <!-- 입출고 단말기 일련번호별 삭제 -->
	<delete id="deleteInoutEqt" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_INOUT_EQT
		WHERE	SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
			AND ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}		--제품ID
    </delete>
    
	
	<!-- 단말기입출고내역 조회 -->
	<select id="lgstCntrInOutEqtList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT	TIE.SO_ID			-- 사업자ID
				, TIE.INOUT_ID		--입출고ID
				, TIE.ITEM_ID		--제품ID
				, TIE.EQT_SEQ		--일련번호
				, TIE.EQT_BAR_CD	--바코드
				, TIE.APPR_YN		--검수여부
				, TI.ITEM_NM		--물류처리상태  
		FROM 	TDNDT_INOUT_EQT TIE
				, TDNDT_ITEM TI
		WHERE 	TIE.SO_ID 		= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND TIE.SO_ID 		= TI.SO_ID
			AND TIE.ITEM_ID 	= TI.ITEM_ID
			AND TIE.INOUT_ID 	= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
		ORDER BY TIE.EQT_SEQ
				
	</select>
	
	
	<!-- 물류센터 출고 단말기내역 리스트 조회 출고검수 -->
	<select id="lgstCntrOutEqtCheckList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		SELECT
				CASE WHEN A.ITEM_ID IS NULL THEN 'X' ELSE A.ITEM_ID END AS ITEM_ID
				, A.EQT_SEQ		--일련번호
		FROM 	TDNDT_EQT A		--단말기  
		WHERE 	1 = 1
			AND A.SO_ID 	= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND SUBSTR(A.LGST_PROC_STAT_CD, -1) = '1'
			AND A.EQT_STAT_CD 	= '001'
			AND A.EQT_BAR_CD 	= #{logisticsCenterIssueInspVO.eqtBarCd}
			AND A.OWN_LOC_CD 	= #{logisticsCenterIssueInspVO.inoutOrgId}
			
	</select>
	
	<!-- 입고단말기 내역 수정 -->
	<update id="updateLgstCntrInOutEqtInfo" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		UPDATE 	TDNDT_INOUT_EQT
			SET CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
				, EQT_SEQ 			= #{logisticsCenterIssueInspVO.eqtSeq}		--
		WHERE 	SO_ID 			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
			AND ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}		--제품ID
			AND EQT_BAR_CD 		= #{logisticsCenterIssueInspVO.eqtBarCd}	--
	</update>
		
		
	<!-- 출고검수시 에러난 입고단말기를 삭제 -->
	<delete id="deleteLgstCntrInOutEqtInfo" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_INOUT_EQT
		WHERE	SO_ID			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
			AND ITEM_ID 		= #{logisticsCenterIssueInspVO.itemId}		--제품ID
			AND EQT_SEQ 		= #{logisticsCenterIssueInspVO.eqtSeq}		--
    </delete>	
		
	
	<!-- 출고수량에서 검수수량합계를 뺀 수량 조회 -->
	<select id="countMinusInOutQty" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="int" >
	
		SELECT TID.INOUT_QTY - ( SELECT COUNT(*)
									FROM 	TDNDT_INOUT_EQT
									WHERE 	SO_ID 		= TID.SO_ID
										AND INOUT_ID 	= TID.INOUT_ID
										AND ITEM_ID  	= TID.ITEM_ID ) AS QTY
		FROM 	TDNDT_INOUT_DTL TID
		WHERE 	TID.SO_ID 		= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND TID.INOUT_ID 	= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
           
	</select>
	
	<!-- 입고단말기 내역 수정 -->
	<update id="updateEqtInfo" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		UPDATE TDNDT_EQT
			SET	LGST_PROC_STAT_CD	= #{logisticsCenterIssueInspVO.lgstProcStatCd}	--물류처리상태코드
				, LGST_PROC_DTTM	= #{logisticsCenterIssueInspVO.lgstProcDttm}	--물류처리일시
				, DSTRB_UT_PRC 		= #{logisticsCenterIssueInspVO.dstrbUtPrc}		--유통단가
				, CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
		WHERE	SO_ID				= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND ITEM_ID				= #{logisticsCenterIssueInspVO.itemId}		--제품ID
			<if test="logisticsCenterIssueInspVO.eqtSeqList != null and logisticsCenterIssueInspVO.eqtSeqList.size() != 0">
			AND EQT_SEQ IN
			<foreach collection="logisticsCenterIssueInspVO.eqtSeqList" item="item" index="index" separator="," open="(" close=")">
	            #{item.eqtSeq}
	        </foreach>
        </if>
        
	</update>
		
		
	<!-- 일련번호별 상태 및 용도 변경 처리 이력 -->
	<insert id="insertUpdProcHist" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT	ALL 		
		<foreach collection="logisticsCenterIssueInspVOs" item="logisticsCenterIssueInspVO" index="index" separator="" open="" close="">
		
			INTO TDNDT_UPD_PROC_HIST
				( HIST_SEQ			--이력일련번호
				, UPD_PROC_CL_CD	--변경처리구분코드
				, SO_ID				--사업ID
				, ITEM_ID			--제품ID
				, EQT_SEQ			--단말기일련번호
				, USIM_SEQ			--USIM일련번호
				, UPD_BFR_CD		--변경전코드
				, AFTR_UPD_CD		--변경후코드
				, UPD_PROC_ID		--변경처리자ID
				, UPD_PROC_DTTM		--변경처리일시
				, REGR_ID			--등록자
				, REG_DATE			--등록일시
				, CHGR_ID			--수정자
				, CHG_DATE			--수정일시
				)
	        VALUES
				( #{logisticsCenterIssueInspVO.histSeq}			--이력일련번호
				, #{logisticsCenterIssueInspVO.updProcClCd}		--변경처리구분코드
				, #{logisticsCenterIssueInspVO.soId}			--사업ID
				, #{logisticsCenterIssueInspVO.itemId}			--제품ID
				, #{logisticsCenterIssueInspVO.eqtSeq}			--단말기일련번호
				, #{logisticsCenterIssueInspVO.eqtSeq}			--USIM일련번호
				, #{logisticsCenterIssueInspVO.aftrUpdCd}		--변경전코드
				, #{logisticsCenterIssueInspVO.aftrUpdCd}		--변경후코드
				, #{logisticsCenterIssueInspVO.updProcId}		--변경처리자ID
				, #{logisticsCenterIssueInspVO.updProcDttm}		--변경처리일시
				, #{logisticsCenterIssueInspVO.regrId}			--등록자
				, #{logisticsCenterIssueInspVO.regDate}			--등록일시
				, #{logisticsCenterIssueInspVO.chgrId}			--수정자
				, #{logisticsCenterIssueInspVO.chgDate}			--수정일시
				)	
		</foreach>
		SELECT * FROM DUAL	
		
	</insert>
	
	<!-- USIM 내역 수정 -->
	<update id="updateUsim3" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		UPDATE TDNDT_USIM
			SET	IDL_STAT_CD			= #{logisticsCenterIssueInspVO.idlStatCd}				--물류처리상태코드
				, LGST_PROC_STAT_CD	= #{logisticsCenterIssueInspVO.lgstProcStatCd}	--물류처리상태코드
				, LGST_PROC_DTTM	= #{logisticsCenterIssueInspVO.lgstProcDttm}	--물류처리일시
				, DSTRB_UT_PRC 		= #{logisticsCenterIssueInspVO.dstrbUtPrc}		--유통단가
				, CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
		WHERE	SO_ID				= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND ITEM_ID				= #{logisticsCenterIssueInspVO.itemId}		--제품ID
			<if test="logisticsCenterIssueInspVO.eqtSeqList != null and logisticsCenterIssueInspVO.eqtSeqList.size() != 0">
			AND USIM_SEQ IN
			<foreach collection="logisticsCenterIssueInspVO.eqtSeqList" item="item" index="index" separator="," open="(" close=")">
	            #{item.eqtSeq}
	        </foreach>
        </if>
	</update>
	
	<!-- 바우쳐마스터 정보 수정 -->
	<update id="updateVeqtInfoVoStatLgst" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		UPDATE TDNDT_VEQT
			SET	VO_STAT_CD			= #{logisticsCenterIssueInspVO.voStatCd}		--바우쳐상태
				, LGST_PROC_STAT_CD	= #{logisticsCenterIssueInspVO.lgstProcStatCd}	--물류처리상태코드
				, LGST_PROC_DTTM	= #{logisticsCenterIssueInspVO.lgstProcDttm}	--물류처리일시
				, DSTRB_UT_PRC 		= #{logisticsCenterIssueInspVO.dstrbUtPrc}		--유통단가
				, CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
		WHERE	SO_ID				= #{logisticsCenterIssueInspVO.soId}		--사업ID
			<if test="logisticsCenterIssueInspVO.eqtSeqList != null and logisticsCenterIssueInspVO.eqtSeqList.size() != 0">
				AND VO_SEQ_NO IN
				<foreach collection="logisticsCenterIssueInspVO.eqtSeqList" item="item" index="index" separator="," open="(" close=")">
		            #{item.eqtSeq}
		        </foreach>
	        </if>
	</update>
	
	
	<!-- 바우처마스터 리스트 조회 -->
	<select id="selectVeqtList" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		SELECT
				VO_SEQ_NO			--바우쳐일련번호
				, SO_ID				--사업ID
				, ITEM_ID			--제품ID
				, VO_BAR_CD			--바우쳐바코드
				, VO_STAT_CD		--바우쳐상태코드
				, VO_ISSUE_DT		--바우쳐발행일자
				, VO_EXPIRED_DT		--바우쳐만료일자
				, VO_ISSUE_AMT		--바우쳐발행금액
				, VO_PROD_CD		--바우쳐상품
				, LGST_PROC_STAT_CD	--물류처리상태코드
				, LGST_PROC_DTTM	--물류처리일시
				, OWN_LOC_CD		--소유위치코드
				, FRST_IN_DT		--최초물류센터입고일자
				, AGC_IN_DT			--대리점입고일자
				, PRCHS_UT_PRC		--매입단가
				, DSTRB_UT_PRC		--유통단가
				, CT_ORG_ID			--접점조직
				, CT_CHG_ID			--접점변경자
				, CT_CHG_DT			--접점변경일
				, REMARK			--비고
		FROM	TDNDT_VEQT_TRANS
		WHERE 	SO_ID				= #{logisticsCenterIssueInspVO.soId}		--사업ID
			<if test="logisticsCenterIssueInspVO.eqtSeqList != null and logisticsCenterIssueInspVO.eqtSeqList.size() != 0">
				AND VO_SEQ_NO IN
				<foreach collection="logisticsCenterIssueInspVO.eqtSeqList" item="item" index="index" separator="," open="(" close=")">
		            #{item.eqtSeq}
		        </foreach>
	        </if>
	        
	</select>		
			
			
	<!-- 바우처 이력 등록 -->
	<insert id="insertVeqtTrans" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT	ALL 		
		<foreach collection="logisticsCenterIssueInspVOs" item="logisticsCenterIssueInspVO" index="index" separator="" open="" close="">
		
			INTO TDNDT_VEQT_TRANS
				( CRT_SEQ_NO			--이력생성일련번호
				, SO_ID					--사업구분
				, VO_SEQ_NO				--바우쳐일련번호
				, VO_BAR_CD				--바우쳐바코드
				, ITEM_ID				--제품ID
				, VO_STAT_CD			--바우쳐상태코드
				, VO_ISSUE_DT			--바우쳐발행일자
				, VO_EXPIRED_DT			--바우쳐만료일자
				, VO_ISSUE_AMT			--바우쳐발행금액
				, VO_PROD_CD			--바우쳐상품
				, LGST_PROC_STAT_CD		--물류처리상태코드
				, LGST_PROC_DTTM		--물류처리일시
				, OWN_LOC_CD			--소유위치코드
				, FRST_IN_DT			--최초물류센터입고일자
				, AGC_IN_DT				--대리점입고일자
				, PRCHS_UT_PRC			--매입단가
				, DSTRB_UT_PRC			--유통단가
				, CT_ORG_ID				--접점조직
				, CT_CHG_ID				--접점변경자
				, CT_CHG_DT				--접점변경일
				, REMARK				--비고
				, REGR_ID				--등록자ID
				, REG_DATE				--등록일자
				, CHGR_ID				--변경자ID
				, CHG_DATE				--변경일자
				)
	        VALUES
				( #{logisticsCenterIssueInspVO.crtSeqNo}		--이력생성일련번호
				, #{logisticsCenterIssueInspVO.soId}			--사업구분
				, #{logisticsCenterIssueInspVO.voSeqNo}			--바우쳐일련번호
				, #{logisticsCenterIssueInspVO.voBarCd}			--바우쳐바코드
				, #{logisticsCenterIssueInspVO.itemId}			--제품ID
				, #{logisticsCenterIssueInspVO.voStatCd}		--바우쳐상태코드
				, #{logisticsCenterIssueInspVO.voIssueDt}		--바우쳐발행일자
				, #{logisticsCenterIssueInspVO.voExpiredDt}		--바우쳐만료일자
				, #{logisticsCenterIssueInspVO.voIssueAmt}		--바우쳐발행금액
				, #{logisticsCenterIssueInspVO.voProdCd}		--바우쳐상품
				, #{logisticsCenterIssueInspVO.lgstProcStatCd}	--물류처리상태코드
				, #{logisticsCenterIssueInspVO.lgstProcDttm}	--물류처리일시
				, #{logisticsCenterIssueInspVO.ownLocCd}		--소유위치코드
				, #{logisticsCenterIssueInspVO.frstInDt}		--최초물류센터입고일자
				, #{logisticsCenterIssueInspVO.agcInDt}			--대리점입고일자
				, #{logisticsCenterIssueInspVO.prchsUtPrc}		--매입단가
				, #{logisticsCenterIssueInspVO.dstrbUtPrc}		--유통단가
				, #{logisticsCenterIssueInspVO.ctOrgId}			--접점조직
				, #{logisticsCenterIssueInspVO.ctChgId}			--접점변경자
				, #{logisticsCenterIssueInspVO.ctChgDt}			--접점변경일
				, #{logisticsCenterIssueInspVO.remark}			--비고
				, #{logisticsCenterIssueInspVO.regrId}			--등록자ID
				, #{logisticsCenterIssueInspVO.regDate}			--등록일자
				, #{logisticsCenterIssueInspVO.chgrId}			--변경자ID
				, #{logisticsCenterIssueInspVO.chgDate}			--변경일자
				)	
		</foreach>
		SELECT * FROM DUAL	
		
	</insert>
	
	
	<!-- 입고단말기 내역 수정 -->
	<update id="updateInOutInfo" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		UPDATE 	TDNDT_INOUT
			SET CHGR_ID 			= #{logisticsCenterIssueInspVO.chgrId}		--수정자
				, CHG_DATE 			= #{logisticsCenterIssueInspVO.chgDate}		--수정일시
				, INOUT_PRGR_STAT_CD = #{logisticsCenterIssueInspVO.inoutPrgrStatCd}		--
				, STAT_PROC_ID 		= #{logisticsCenterIssueInspVO.statProcId}		--
				, STAT_PROC_DTTM 	= #{logisticsCenterIssueInspVO.statProcDttm}		--
				, OWN_ORG_ID 		= #{logisticsCenterIssueInspVO.ownOrgId}		--
				, INOUT_ORG_ID 		= #{logisticsCenterIssueInspVO.inoutOrgId}		--
		WHERE 	SO_ID 			= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND INOUT_ID 		= #{logisticsCenterIssueInspVO.inoutId}		--입출고ID
	</update>
			
			
	<!-- 입출고 및 배송 대기 상태의 제품을 관리 등록 -->
	<insert id="insertProcIdlDtl" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
	
		INSERT INTO TDNDT_PROC_IDL_DTL
			( SO_ID					--사업ID
			, INOUT_ID				--입출고ID
			, IDL_STAT_CD			--대기상태코드
			, REGR_ID				--등록자
			, REG_DATE				--등록일시
			, CHGR_ID				--수정자
			, CHG_DATE				--수정일시
			)
        VALUES
			( #{logisticsCenterIssueInspVO.soId}			--사업ID
			, #{logisticsCenterIssueInspVO.inoutId}			--입출고ID
			, #{logisticsCenterIssueInspVO.idlStatCd}		--대기상태코드
			, #{logisticsCenterIssueInspVO.regrId}			--등록자
			, #{logisticsCenterIssueInspVO.regDate}			--등록일시
			, #{logisticsCenterIssueInspVO.chgrId}			--수정자
			, #{logisticsCenterIssueInspVO.chgDate}			--수정일시
			)			
	</insert>		
				
				
	<!-- 주문수량에서 입고수량합계를 뺀 수량 조회 -->
	<select id="countOrdMinusInOutQty" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO" resultType="int" >
	
		SELECT TA.ORD_CONF_QTY - CASE WHEN ( SELECT SUM(TID.INOUT_QTY)
												FROM TDNDT_INOUT TI
													, TDNDT_INOUT_DTL TID
												WHERE TA.SO_ID = TID.SO_ID
													AND TA.ORD_NO = TID.ORD_NO
													AND TI.SO_ID = TID.SO_ID
													AND TI.INOUT_ID = TID.INOUT_ID
													AND TID.INOUT_CL_CD = '2'
													AND TI.INOUT_PRGR_STAT_CD = '20' )
									IS NULL THEN 0
									ELSE
										( SELECT SUM(TID.INOUT_QTY)
											FROM TDNDT_INOUT TI
												, TDNDT_INOUT_DTL TID
											WHERE TA.SO_ID = TID.SO_ID
												AND TA.ORD_NO = TID.ORD_NO
												AND TI.SO_ID = TID.SO_ID
												AND TI.INOUT_ID = TID.INOUT_ID
												AND TID.INOUT_CL_CD = '2'
												AND TI.INOUT_PRGR_STAT_CD = '20' )
									END AS QTY
		FROM 	TDNDT_ORD TA
		WHERE 	TA.SO_ID 		= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND TA.ORD_NO 		= #{logisticsCenterIssueInspVO.ordNo}		--주문번호
           
	</select>	
	
	<!-- 주문처리대기상태정보를 삭제 -->
	<delete id="deleteOrdIdlDtl" parameterType="com.ntels.ccbs.distribute.domain.logistics.logisticsCenterReceIssue.LogisticsCenterIssueInspVO">
		DELETE
		FROM	TDNDT_ORD_IDL_DTL
		WHERE 	SO_ID 		= #{logisticsCenterIssueInspVO.soId}		--사업ID
			AND ORD_NO 		= #{logisticsCenterIssueInspVO.ordNo}		--주문번호
    </delete>
				
</mapper>





